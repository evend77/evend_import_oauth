<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Importer vos annonces eBay vers e-Vend</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Couleurs personnalis√©es pour simplifier les encadr√©s */
        .alert-info-custom { background-color: #d0ebff; border-radius: 12px; padding: 15px; margin-bottom: 20px; }
        .alert-success-custom { background-color: #b2f2bb; border-radius: 12px; padding: 10px; margin-top: 10px; }
        .alert-warning-custom { background-color: #ffe066; border-radius: 12px; padding: 15px; }
    </style>
</head>
<body class="bg-light">

<div class="container py-5">
    <div class="card shadow-lg p-4 mx-auto" style="max-width: 800px; border-radius: 15px;">

        <h1 class="text-center mb-4 text-primary">üì¶ Importer vos annonces eBay vers e-Vend</h1>

        <!-- Avertissement e-Vend -->
        <div class="alert alert-danger text-center fw-bold mb-4" style="border-radius: 12px;">
            ‚ö†Ô∏è Veuillez vous connecter √† votre compte e-Vend avant de lancer la proc√©dure.
        </div>

        <!-- Bloc regroup√© messages + connect√© eBay -->
        {% with messages = get_flashed_messages() %}
        {% if messages or connected %}
            <div class="alert-info-custom">
                {% if messages %}
                    <h5 class="fw-bold text-center mb-3">Messages</h5>
                    <ul class="mb-0">
                        {% for message in messages %}
                            <li>{{ message }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}
                {% if connected %}
                    <div class="alert-success-custom text-center fw-bold">
                        ‚úÖ Vous √™tes connect√© √† eBay !
                    </div>
                {% endif %}
            </div>
        {% endif %}
        {% endwith %}

        {% if not connected %}
            <div class="text-center">
                <p class="mb-3">Vous devez connecter votre compte eBay pour continuer.</p>
                <a href="{{ url_for('login_ebay') }}" class="btn btn-primary btn-lg w-100">
                    üîë Se connecter avec eBay
                </a>
            </div>
        {% else %}
            <!-- √âtape 1 : T√©l√©charger vos annonces eBay -->
            <div class="mb-4">
                <h2 class="h5 text-secondary" style="font-weight: 900;"><strong>√âtape 1: T√©l√©charger vos annonces eBay</strong></h2>
                <p>Dans cette premi√®re √©tape, vous allez exporter vos annonces eBay au format CSV afin de pouvoir les pr√©parer pour l‚Äôimportation sur e-Vend. Une fois t√©l√©charg√©, vous pourrez v√©rifier et ajuster vos informations avant de passer √† l‚Äô√©tape suivante, l‚Äôimportation sur e-Vend.</p>
                <p>‚ö†Ô∏è Remarque importante : Vous devez √™tre connect√© √† votre compte eBay pour t√©l√©charger vos annonces. Votre quota journalier d‚Äôexportation est limit√©, donc assurez-vous de ne pas d√©passer la limite.</p>
                {% if remaining_quota > 0 %}
                    <a href="{{ url_for('download_ebay_csv') }}" class="btn btn-success btn-lg w-100">
                        ‚¨áÔ∏è T√©l√©charger mon CSV eBay
                    </a>
                {% else %}
                    <button class="btn btn-outline-secondary btn-lg w-100" disabled>
                        ‚ö†Ô∏è Quota journalier atteint
                    </button>
                {% endif %}
            </div>

            <!-- √âtape 2 : Importer un CSV sur e-Vend -->
            <div class="mb-4">
                <h2 class="h5 text-secondary" style="font-weight: 900;"><strong>√âtape 2: Importer un CSV sur e-Vend</strong></h2>
                <p>Dans cette √©tape, vous devez importer le CSV que vous avez obtenu de eBay et pr√©alablement v√©rifi√© dans "BROWSE". En bas, vous pourrez renseigner des valeurs par d√©faut √† utiliser si eBay ne fournit pas certaines informations pour un article, afin d'√©viter toute interruption lors du transfert vers e-Vend. Il vous sera possible de venir modifier ces valeurs plus tard sur votre compte vendeur. Votre adresse courriel ainsi que votre mot de passe sont n√©cessaires afin d'ajouter vos nouvelles annonces. Une fois que tout est termin√©, nous vous conseillons de les changer.</p>

                <form action="{{ url_for('post_evend') }}" method="post" enctype="multipart/form-data">
                    <!-- Browse CSV -->
                    <input type="file" class="form-control mb-3" name="csv_file" accept=".csv" required>

                    <!-- Section Identifiants e-Vend -->
                    <div class="alert alert-info-custom mb-3">
                        <h6 class="fw-bold">üîë Identifiants e-Vend</h6>

                        <!-- Email -->
                        <div class="mb-2">
                            <label class="form-label">Email e-Vend</label>
                            <input type="email" class="form-control" name="evend_email" placeholder="exemple@domaine.com" required>
                        </div>

                        <!-- Mot de passe -->
                        <div class="mb-2">
                            <label class="form-label">Mot de passe e-Vend</label>
                            <input type="password" class="form-control" name="evend_password" placeholder="Votre mot de passe" required>
                        </div>
                    </div>

                    <!-- Valeurs par d√©faut si eBay ne fournit pas certaines infos -->
                    <div class="alert alert-info-custom mb-3">
                        <h6 class="fw-bold">Valeurs par d√©faut (si eBay ne fournit pas)</h6>

                        <!-- Type d'annonce -->
                        <div class="mb-2">
                            <label class="form-label">Type d‚Äôannonce</label>
                            <select class="form-select" name="type_annonce">
                                <option selected>Article neuf</option>
                                <option>Article d'occasion</option>
                                <option>Article remis √† neuf</option>
                            </select>
                        </div>

                        <!-- Cat√©gorie -->
                        <div class="mb-2">
                            <label class="form-label">Cat√©gorie</label>
                            <select class="form-select" name="categorie">
                                <option selected disabled>-- S√©lectionner une cat√©gorie --</option>
                                <option value="Accessoires et bijoux">Accessoires et bijoux > Autre</option>
                                <option value="Aliments">Aliments > Autre</option>
                                <option value="Animaux">Animaux > Autre</option>
                                <option value="Antiquit√©s">Antiquit√©s > Autre</option>
                                <option value="Art">Art > Autre</option>
                                <option value="Articles pour animaux">Articles pour animaux > Autre</option>
                                <option value="Artisanat">Artisanat > Autre</option>
                                <option value="Automobile / Machinerie">Automobile / Machinerie > Autre</option>
                                <option value="Bluray">Bluray > Autre</option>
                                <option value="Bureau / papeterie">Bureau / papeterie > Autre</option>
                                <option value="CD">CD > Autre</option>
                                <option value="Collection">Collection > Autre</option>
                                <option value="Cours et jardin">Cours et jardin > Autre</option>
                                <option value="D√©coration / maison">D√©coration / maison > Autre</option>
                                <option value="DVD">DVD > Autre</option>
                                <option value="√âlectronique">√âlectronique > Autre</option>
                                <option value="Hydraulique">Hydraulique > Autre</option>
                                <option value="Jeux video / console">Jeux video / console > Autre</option>
                                <option value="Jouets / Jeux">Jouets / Jeux > Autre</option>
                                <option value="Livres">Livres > Autre</option>
                                <option value="Meuble">Meuble > Autre</option>
                                <option value="Outils">Outils > Autre</option>
                                <option value="Produits hygi√®ne et beaut√©">Produits hygi√®ne et beaut√© > Autre</option>
                                <option value="Quincaillerie">Quincaillerie > Autre</option>
                                <option value="Sports et plein-air">Sports et plein-air > Autre</option>
                                <option value="V√™tements / Chaussures et accessoires">V√™tements / Chaussures et accessoires > Autre</option>
                                <option value="Vinyles / VHS / Cassettes">Vinyles / VHS / Cassettes > Autre</option>
                                <option value="Autre / Divers">Autre / Divers > Autre</option>
                            </select>
                        </div>

                        <!-- Titre de l'annonce -->
                        <div class="mb-2">
                            <label class="form-label">Titre de l'annonce</label>
                            <input type="text" class="form-control" name="titre" placeholder="Ex : Magnifique montre vintage" value="">
                        </div>

                        <!-- Descriptif -->
                        <div class="mb-2">
                            <label class="form-label">Descriptif de l'annonce</label>
                            <textarea class="form-control" name="description" placeholder="D√©crivez votre article ici..."></textarea>
                        </div>

                        <!-- √âtat de l'article -->
                        <div class="mb-2">
                            <label class="form-label">√âtat de l'article (condition)</label>
                            <select class="form-select" name="condition">
                                <option selected>1. Neuf / Jamais utilis√© ‚Äì L‚Äôarticle est neuf, dans son emballage d‚Äôorigine</option>
                                <option>2. Comme neuf ‚Äì Utilis√© une ou deux fois, en excellent √©tat</option>
                                <option>3. Tr√®s bon √©tat ‚Äì Quelques signes mineurs d‚Äôusure, mais fonctionne parfaitement</option>
                                <option>4. Bon √©tat ‚Äì L‚Äôarticle a √©t√© utilis√©, mais reste en bon √©tat g√©n√©ral</option>
                                <option>5. √âtat correct ‚Äì Pr√©sente des marques d‚Äôusure visibles, mais fonctionne</option>
                                <option>6. Us√© / Bien utilis√© ‚Äì L‚Äôarticle fonctionne mais montre des signes d‚Äôusage importants</option>
                                <option>7. √Ä r√©parer ‚Äì Ne fonctionne pas ou endommag√©, peut √™tre r√©par√©</option>
                                <option>8. Pour pi√®ces ‚Äì Non fonctionnel, vendu pour r√©cup√©rer des pi√®ces</option>
                            </select>
                        </div>

                        <!-- Retour offert -->
                        <div class="mb-2">
                            <label class="form-label">Retour offert</label>
                            <select class="form-select" name="retour">
                                <option selected>Non, aucun retour accept√©</option>
                                <option>Oui, retour sous 30 jours apr√®s date d'achat</option>
                            </select>
                        </div>

                        <!-- Garantie -->
                        <div class="mb-2">
                            <label class="form-label">Garantie offerte</label>
                            <select class="form-select" name="garantie">
                                <option selected>Non, aucune garantie n'est offerte</option>
                                <option>Non, aucune garantie, vendu tel quel</option>
                                <option>Oui, une garantie est offerte (d√©tails dans description)</option>
                            </select>
                        </div>

                        <!-- Prix -->
                        <div class="mb-2">
                            <label class="form-label">Prix ($) -minimun 5$</label>
                            <input type="number" class="form-control" name="prix" value="0" step="0.01" min="5">
                        </div>

                        <!-- Stock -->
                        <div class="mb-2">
                            <label class="form-label">Stock disponible</label>
                            <input type="number" class="form-control" name="stock" value="1" min="1">
                        </div>

                        <!-- Frais de port -->
                        <div class="mb-2">
                            <label class="form-label">Frais de port pour le 1er article ($)</label>
                            <input type="number" class="form-control" name="frais_port_article" value="0" step="0.01" min="0">
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Frais de port suppl√©mentaire par article ($)</label>
                            <input type="number" class="form-control" name="frais_port_sup" value="0" step="0.01" min="0">
                        </div>

                        <!-- Photo par d√©faut -->
                        <div class="mb-2">
                            <label class="form-label">URL de photo par d√©faut</label>
                            <input type="text" class="form-control" name="photo_defaut" placeholder="https://...">
                        </div>

                        <!-- Options de livraison -->
                        <div class="mb-2">
                            <label class="form-label fw-bold">Mode de livraison</label>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="livraison_ramassage_check" id="livraison_ramassage_check">
                                <label class="form-check-label" for="livraison_ramassage_check">Ramassage sur place</label>
                                <input type="text" class="form-control mt-1" name="livraison_ramassage" placeholder="Adresse de ramassage" style="display:none;">
                            </div>
                            <div class="form-check mt-2">
                                <input class="form-check-input" type="checkbox" name="livraison_expedition_check" id="livraison_expedition_check">
                                <label class="form-check-label" for="livraison_expedition_check">Exp√©dition par transporteur</label>
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary btn-lg w-100">
                        üöÄ Importer sur e-Vend
                    </button>
                </form>
            </div>

            <!-- Bloc log dynamique -->
            <div class="alert alert-warning-custom">
                <h6 class="fw-bold">Logs d‚Äôimport en arri√®re-plan</h6>
                <pre id="log-content" style="max-height: 300px; overflow-y: auto;"></pre>
            </div>
        {% endif %}
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- Script pour log dynamique et masquage adresse ramassage -->
<script>
function refreshLog() {
    fetch('{{ url_for("get_import_log") }}')
        .then(response => response.json())
        .then(data => {
            document.getElementById('log-content').textContent = data.log;
        })
        .catch(err => console.error('Erreur r√©cup√©ration log:', err));
}

// Rafra√Æchir toutes les 5 secondes
setInterval(refreshLog, 5000);

// Masquer/afficher l'adresse de ramassage
function toggleRamassage() {
    const check = document.getElementById('livraison_ramassage_check');
    const input = document.querySelector('input[name="livraison_ramassage"]');
    input.style.display = check.checked ? 'block' : 'none';
}

// Initialisation
document.getElementById('livraison_ramassage_check').addEventListener('change', toggleRamassage);
window.addEventListener('load', toggleRamassage);
</script>

</body>
</html>
