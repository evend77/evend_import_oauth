<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Importer vos annonces eBay vers e-Vend</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Couleurs personnalisées pour simplifier les encadrés */
        .alert-info-custom { background-color: #d0ebff; border-radius: 12px; padding: 15px; margin-bottom: 20px; }
        .alert-success-custom { background-color: #b2f2bb; border-radius: 12px; padding: 10px; margin-top: 10px; }
        .alert-warning-custom { background-color: #ffe066; border-radius: 12px; padding: 15px; }
    </style>
</head>
<body class="bg-light">

<div class="container py-5">
    <div class="card shadow-lg p-4 mx-auto" style="max-width: 800px; border-radius: 15px;">

        <h1 class="text-center mb-4 text-primary">📦 Importer vos annonces eBay vers e-Vend</h1>

        <!-- Avertissement e-Vend -->
        <div class="alert alert-danger text-center fw-bold mb-4" style="border-radius: 12px;">
            ⚠️ Veuillez vous connecter à votre compte e-Vend avant de lancer la procédure.
        </div>

        <!-- Bloc messages + connecté eBay -->
        {% with messages = get_flashed_messages() %}
        {% if messages or connected %}
            <div class="alert-info-custom">
                {% if messages %}
                    <h5 class="fw-bold text-center mb-3">Messages</h5>
                    <ul class="mb-0">
                        {% for message in messages %}
                            <li>{{ message }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}
                {% if connected %}
                    <div class="alert-success-custom text-center fw-bold">
                        ✅ Vous êtes connecté à eBay !
                    </div>
                {% endif %}
            </div>
        {% endif %}
        {% endwith %}

        {% if not connected %}
            <div class="text-center mb-4">
                <p class="mb-3">Vous devez connecter votre compte eBay pour continuer.</p>
                <a href="{{ url_for('login_ebay') }}" class="btn btn-primary btn-lg w-100">
                    🔑 Se connecter avec eBay
                </a>
            </div>
        {% else %}
            <!-- Étape 1 : Télécharger vos annonces eBay -->
            <div class="mb-4">
                <h2 class="h5 text-secondary" style="font-weight: 900;"><strong>Étape 1: Télécharger vos annonces eBay</strong></h2>
                <p>Exportez vos annonces eBay au format CSV pour préparer l'importation sur e-Vend.</p>
                {% if remaining_quota > 0 %}
                    <a href="{{ url_for('download_ebay_csv') }}" class="btn btn-success btn-lg w-100">
                        ⬇️ Télécharger mon CSV eBay
                    </a>
                {% else %}
                    <button class="btn btn-outline-secondary btn-lg w-100" disabled>
                        ⚠️ Quota journalier atteint
                    </button>
                {% endif %}
            </div>

            <!-- Étape 2 : Importer un CSV sur e-Vend -->
            <div class="mb-4">
                <h2 class="h5 text-secondary" style="font-weight: 900;"><strong>Étape 2: Importer un CSV sur e-Vend</strong></h2>
                <p>Importez votre CSV et renseignez vos valeurs par défaut pour e-Vend.</p>

                <!-- Formulaire login e-Vend Option 2 -->
                <div class="alert alert-info-custom mb-3">
                    <h6 class="fw-bold">Connexion e-Vend (Option 2)</h6>
                    <form id="evend-login-form" method="post" action="{{ url_for('post_evend') }}" enctype="multipart/form-data">
                        <div class="mb-2">
                            <label class="form-label">Email e-Vend</label>
                            <input type="email" class="form-control" name="evend_email" placeholder="Votre email e-Vend" required>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Mot de passe e-Vend</label>
                            <input type="password" class="form-control" name="evend_password" placeholder="Votre mot de passe e-Vend" required>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">CSV eBay à importer</label>
                            <input type="file" class="form-control" name="csv_file" accept=".csv" required>
                        </div>
                        <button type="submit" class="btn btn-success btn-lg w-100 mb-3">
                            📤 Importer sur e-Vend
                        </button>
                    </form>
                </div>

                <!-- Bloc valeurs par défaut déjà existant -->
                <form action="{{ url_for('post_evend') }}" method="post" enctype="multipart/form-data">
                    <input type="file" class="form-control mb-3" name="csv_file" accept=".csv" required>
                    <!-- Ici tu gardes tous tes champs de valeurs par défaut existants -->
                    <!-- Type d'annonce, catégorie, titre, description, condition, retour, garantie, prix, stock, livraison, photo -->
                    <!-- ... (inchangé) ... -->
                </form>
            </div>

            <!-- Réinitialiser le dernier CSV eBay -->
            <div class="mb-4">
                <h2 class="h5 text-secondary" style="font-weight: 900;"><strong>🧹 Réinitialiser le dernier CSV eBay</strong></h2>
                <form action="{{ url_for('reset_csv') }}" method="post">
                    <button type="submit" class="btn btn-warning btn-lg w-100">
                        🔄 Supprimer le dernier CSV
                    </button>
                </form>
            </div>

            <!-- Déconnexion eBay avec titre -->
            <div class="mb-4">
                <h2 class="h5 text-secondary" style="font-weight: 900;"><strong>🔓 Vous pouvez vous déconnecter de eBay ici</strong></h2>
                <div class="text-center">
                    <a href="{{ url_for('logout_ebay') }}" class="btn btn-danger btn-lg w-100 mt-2">
                        🔓 Se déconnecter de eBay
                    </a>
                </div>
            </div>

            <!-- Limites d'importation -->
            <div class="alert alert-warning-custom mt-4">
                <h5 class="fw-bold">⚠️ Limites d'importation :</h5>
                <ul class="mb-0">
                    <li>📁 <strong>500 articles maximum</strong> par fichier CSV</li>
                    <li>📅 <strong>2000 articles maximum</strong> par utilisateur et par jour</li>
                </ul>
            </div>

            <!-- Suivi aujourd'hui -->
            <div class="alert alert-warning-custom mt-3 text-center">
                <h5 class="fw-bold">📊 Suivi aujourd'hui</h5>
                <p class="mb-0">Articles importés aujourd'hui : <strong>{{ today_imported }}</strong></p>
                <p class="mb-0">Articles restants disponibles : <strong>{{ remaining_quota }}</strong></p>
            </div>

        {% endif %}
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
